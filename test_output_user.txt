============================= test session starts =============================
platform win32 -- Python 3.13.2, pytest-7.4.3, pluggy-1.6.0 -- C:\Users\jordi\AppData\Local\Programs\Python\Python313\python.exe
cachedir: .pytest_cache
django: version: 5.1.12, settings: refugis_lliures.settings (from ini)
rootdir: C:\Users\jordi\Desktop\UNI\TFG\Backend\RefugisLliures_Backend
configfile: pytest.ini
plugins: Faker-20.1.0, cov-4.1.0, django-4.7.0, mock-3.12.0
collecting ... collected 88 items

api/tests/user/test_controllers.py::TestUserController::test_create_user_success PASSED [  1%]
api/tests/user/test_controllers.py::TestUserController::test_create_user_duplicate_uid PASSED [  2%]
api/tests/user/test_controllers.py::TestUserController::test_create_user_duplicate_email PASSED [  3%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_uid_success PASSED [  4%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_uid_not_found PASSED [  5%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_uid_empty_uid PASSED [  6%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_success PASSED [  7%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_not_found PASSED [  9%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_duplicate_email PASSED [ 10%]
api/tests/user/test_controllers.py::TestUserController::test_delete_user_success FAILED [ 11%]
api/tests/user/test_controllers.py::TestUserController::test_delete_user_not_found FAILED [ 12%]
api/tests/user/test_controllers.py::TestUserController::test_create_user_dao_returns_none PASSED [ 13%]
api/tests/user/test_controllers.py::TestUserController::test_create_user_exception PASSED [ 14%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_uid_exception PASSED [ 15%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_email_success PASSED [ 17%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_email_not_found PASSED [ 18%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_email_empty_email PASSED [ 19%]
api/tests/user/test_controllers.py::TestUserController::test_get_user_by_email_exception PASSED [ 20%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_empty_uid PASSED [ 21%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_empty_data PASSED [ 22%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_email_same_user PASSED [ 23%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_dao_returns_false PASSED [ 25%]
api/tests/user/test_controllers.py::TestUserController::test_update_user_exception PASSED [ 26%]
api/tests/user/test_controllers.py::TestUserController::test_delete_user_empty_uid PASSED [ 27%]
api/tests/user/test_controllers.py::TestUserController::test_delete_user_dao_returns_false FAILED [ 28%]
api/tests/user/test_controllers.py::TestUserController::test_delete_user_exception FAILED [ 29%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_success PASSED [ 30%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_empty_uid PASSED [ 31%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_empty_refuge_id PASSED [ 32%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_user_not_found PASSED [ 34%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_refuge_not_found PASSED [ 35%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_dao_returns_false PASSED [ 36%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_preferit_exception PASSED [ 37%]
api/tests/user/test_controllers.py::TestUserController::test_remove_refugi_preferit_success PASSED [ 38%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_visitat_success PASSED [ 39%]
api/tests/user/test_controllers.py::TestUserController::test_add_refugi_visitat_visitor_update_fails PASSED [ 40%]
api/tests/user/test_controllers.py::TestUserController::test_remove_refugi_visitat_success PASSED [ 42%]
api/tests/user/test_controllers.py::TestUserController::test_remove_refugi_visitat_visitor_update_fails PASSED [ 43%]
api/tests/user/test_controllers.py::TestUserController::test_get_refugis_preferits_info_success PASSED [ 44%]
api/tests/user/test_controllers.py::TestUserController::test_get_refugis_preferits_info_empty_uid PASSED [ 45%]
api/tests/user/test_controllers.py::TestUserController::test_get_refugis_preferits_info_user_not_found PASSED [ 46%]
api/tests/user/test_controllers.py::TestUserController::test_get_refugis_preferits_info_exception PASSED [ 47%]
api/tests/user/test_controllers.py::TestUserController::test_get_refugis_visitats_info_success PASSED [ 48%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_success PASSED [ 50%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_uid_empty PASSED [ 51%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_uid_none PASSED [ 52%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_refugi_id_empty PASSED [ 53%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_refugi_id_none PASSED [ 54%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_user_not_exists PASSED [ 55%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_refugi_not_exists PASSED [ 56%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_dao_add_fails PASSED [ 57%]
api/tests/user/test_controllers.py::TestAddRefugiPreferit::test_add_refugi_preferit_exception PASSED [ 59%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_success PASSED [ 60%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_uid_empty PASSED [ 61%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_refugi_id_empty PASSED [ 62%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_user_not_exists PASSED [ 63%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_dao_remove_fails PASSED [ 64%]
api/tests/user/test_controllers.py::TestRemoveRefugiPreferit::test_remove_refugi_preferit_exception PASSED [ 65%]
api/tests/user/test_controllers.py::TestGetRefugisPreferitsInfo::test_get_refugis_preferits_info_success PASSED [ 67%]
api/tests/user/test_controllers.py::TestGetRefugisPreferitsInfo::test_get_refugis_preferits_info_empty_list PASSED [ 68%]
api/tests/user/test_controllers.py::TestGetRefugisPreferitsInfo::test_get_refugis_preferits_info_uid_empty PASSED [ 69%]
api/tests/user/test_controllers.py::TestGetRefugisPreferitsInfo::test_get_refugis_preferits_info_user_not_exists PASSED [ 70%]
api/tests/user/test_controllers.py::TestGetRefugisPreferitsInfo::test_get_refugis_preferits_info_exception PASSED [ 71%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_success PASSED [ 72%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_visitor_update_fails PASSED [ 73%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_uid_empty PASSED [ 75%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_refugi_id_none PASSED [ 76%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_user_not_exists PASSED [ 77%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_refugi_not_exists PASSED [ 78%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_dao_add_fails PASSED [ 79%]
api/tests/user/test_controllers.py::TestAddRefugiVisitat::test_add_refugi_visitat_exception PASSED [ 80%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_success PASSED [ 81%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_visitor_update_fails PASSED [ 82%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_uid_none PASSED [ 84%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_refugi_id_empty PASSED [ 85%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_user_not_exists PASSED [ 86%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_dao_remove_fails PASSED [ 87%]
api/tests/user/test_controllers.py::TestRemoveRefugiVisitat::test_remove_refugi_visitat_exception PASSED [ 88%]
api/tests/user/test_controllers.py::TestGetRefugisVisitatsInfo::test_get_refugis_visitats_info_success PASSED [ 89%]
api/tests/user/test_controllers.py::TestGetRefugisVisitatsInfo::test_get_refugis_visitats_info_empty_list PASSED [ 90%]
api/tests/user/test_controllers.py::TestGetRefugisVisitatsInfo::test_get_refugis_visitats_info_uid_none PASSED [ 92%]
api/tests/user/test_controllers.py::TestGetRefugisVisitatsInfo::test_get_refugis_visitats_info_user_not_exists PASSED [ 93%]
api/tests/user/test_controllers.py::TestGetRefugisVisitatsInfo::test_get_refugis_visitats_info_exception PASSED [ 94%]
api/tests/user/test_controllers.py::TestTemplateMethodPattern::test_template_method_calls_correct_list_type_for_preferits PASSED [ 95%]
api/tests/user/test_controllers.py::TestTemplateMethodPattern::test_template_method_calls_correct_list_type_for_visitats PASSED [ 96%]
api/tests/user/test_controllers.py::TestTemplateMethodPattern::test_hook_method_not_called_for_preferits PASSED [ 97%]
api/tests/user/test_controllers.py::TestTemplateMethodPattern::test_hook_method_called_for_visitats_add PASSED [ 98%]
api/tests/user/test_controllers.py::TestTemplateMethodPattern::test_hook_method_called_for_visitats_remove PASSED [100%]

================================== FAILURES ===================================
_________________ TestUserController.test_delete_user_success _________________
api\tests\user\test_controllers.py:215: in test_delete_user_success
    assert success is True
E   assert False is True
---------------------------- Captured stderr call -----------------------------
2025-12-28 23:15:35,652 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:35,697 [FIRESTORE] api.services.firestore_service: Firebase credentials loaded from file: C:\Users\jordi\Desktop\UNI\TFG\Backend\RefugisLliures_Backend\env/firebase-service-account-dev.json
2025-12-28 23:15:35,697 [FIRESTORE] api.services.firestore_service: Firebase initialized successfully
2025-12-28 23:15:35,697 [DAO] api.daos.experience_dao: Firestore QUERY: collection=experiences where creator_uid==test_uid
2025-12-28 23:15:36,149 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:36,154 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:36,154 [DAO] api.daos.doubt_dao: Firestore QUERY: collection=doubts where creator_uid==test_uid
2025-12-28 23:15:36,239 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:36,239 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:36,239 [DAO] api.daos.doubt_dao: Firestore COLLECTION_GROUP_QUERY: answers where creator_uid==test_uid
2025-12-28 23:15:36,359 [ERROR] api.daos.doubt_dao: Error eliminant respostes del creador test_uid: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB 
________________ TestUserController.test_delete_user_not_found ________________
api\tests\user\test_controllers.py:228: in test_delete_user_not_found
    assert 'no trobat' in error
E   AssertionError: assert 'no trobat' in 'Error eliminant respostes: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB '
---------------------------- Captured stderr call -----------------------------
2025-12-28 23:15:36,585 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:36,586 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:36,586 [DAO] api.daos.experience_dao: Firestore QUERY: collection=experiences where creator_uid==nonexistent_uid
2025-12-28 23:15:36,632 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:36,632 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:36,632 [DAO] api.daos.doubt_dao: Firestore QUERY: collection=doubts where creator_uid==nonexistent_uid
2025-12-28 23:15:36,850 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:36,850 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:36,850 [DAO] api.daos.doubt_dao: Firestore COLLECTION_GROUP_QUERY: answers where creator_uid==nonexistent_uid
2025-12-28 23:15:36,935 [ERROR] api.daos.doubt_dao: Error eliminant respostes del creador nonexistent_uid: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB 
____________ TestUserController.test_delete_user_dao_returns_false ____________
api\tests\user\test_controllers.py:409: in test_delete_user_dao_returns_false
    assert 'Error eliminant usuari' in error
E   AssertionError: assert 'Error eliminant usuari' in 'Error eliminant respostes: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB '
---------------------------- Captured stderr call -----------------------------
2025-12-28 23:15:37,094 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,094 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,094 [DAO] api.daos.experience_dao: Firestore QUERY: collection=experiences where creator_uid==test_uid
2025-12-28 23:15:37,146 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,146 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,146 [DAO] api.daos.doubt_dao: Firestore QUERY: collection=doubts where creator_uid==test_uid
2025-12-28 23:15:37,258 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,259 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,259 [DAO] api.daos.doubt_dao: Firestore COLLECTION_GROUP_QUERY: answers where creator_uid==test_uid
2025-12-28 23:15:37,345 [ERROR] api.daos.doubt_dao: Error eliminant respostes del creador test_uid: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB 
________________ TestUserController.test_delete_user_exception ________________
api\tests\user\test_controllers.py:421: in test_delete_user_exception
    assert 'Error intern' in error
E   AssertionError: assert 'Error intern' in 'Error eliminant respostes: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB '
---------------------------- Captured stderr call -----------------------------
2025-12-28 23:15:37,374 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,374 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,374 [DAO] api.daos.experience_dao: Firestore QUERY: collection=experiences where creator_uid==test_uid
2025-12-28 23:15:37,426 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,426 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,426 [DAO] api.daos.doubt_dao: Firestore QUERY: collection=doubts where creator_uid==test_uid
2025-12-28 23:15:37,531 [FIRESTORE] api.services.firestore_service: FirestoreService.get_db called
2025-12-28 23:15:37,531 [FIRESTORE] api.services.firestore_service: Returning existing Firestore client
2025-12-28 23:15:37,531 [DAO] api.daos.doubt_dao: Firestore COLLECTION_GROUP_QUERY: answers where creator_uid==test_uid
2025-12-28 23:15:37,619 [ERROR] api.daos.doubt_dao: Error eliminant respostes del creador test_uid: 400 The query requires a COLLECTION_GROUP_ASC index for collection answers and field creator_uid. You can create it here: https://console.firebase.google.com/v1/r/project/refugislliures-b3669/firestore/indexes?create_exemption=Cl1wcm9qZWN0cy9yZWZ1Z2lzbGxpdXJlcy1iMzY2OS9kYXRhYmFzZXMvKGRlZmF1bHQpL2NvbGxlY3Rpb25Hcm91cHMvYW5zd2Vycy9maWVsZHMvY3JlYXRvcl91aWQQAhoPCgtjcmVhdG9yX3VpZBAB 
=========================== short test summary info ===========================
FAILED api/tests/user/test_controllers.py::TestUserController::test_delete_user_success
FAILED api/tests/user/test_controllers.py::TestUserController::test_delete_user_not_found
FAILED api/tests/user/test_controllers.py::TestUserController::test_delete_user_dao_returns_false
FAILED api/tests/user/test_controllers.py::TestUserController::test_delete_user_exception
================== 4 failed, 84 passed, 8 warnings in 2.77s ===================
